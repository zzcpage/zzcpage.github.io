---
title: Python爬虫开发与项目实战-第二回合（实战）
categories:
    - 爬虫
tags:
    - Python
    - 爬虫
---

爬虫的原理十分简单，通过URL，获取网页资源，再根据网页资源进一步获取需要的信息数据。

我们很容易借助requests,beautifulSoup库等实现一个简答的爬虫。实际上，到了这基本上爬虫的大概就已经学习完毕了。对于我们现在编写的爬虫与大型爬虫的差距在于以下几点：
>1. 实现方式
>2. 优化方式
>3. 稳健性
我们现在仅仅只考虑功能的实现，所以还只是基础爬虫，要实现一个大型的爬虫还因该从效率，稳健性，结构化，维护等方面综合考虑。

![a1](/images/基础爬虫.PNG)

一个爬虫的基础框架可以分为：爬虫调度器，URL管理器，HTML下载器，HTML解析器，数据存储器
1. 爬虫调度器  负责其他四个模块的协调工作

2. URL管理器主要负责URL链接，维护已经爬取的URL集合和未爬取的URL集合，提供互殴去新的URL链接的接口

3. HTML下载器用于从URL管理器中获取未爬取的URL链接并下载HTML页面

4. HTML解析器用于从HTML下载器中获取已经下载的HTML页面，并从中解析出新的URL链接交给URL管理器
解析出有效数据交给数据存储器。

5. 数据存储器用于将HTML解析器解析出来的数据通过文件或数据库的形式存储起来。

爬虫的动态流程如下所示：
![a2](/images/爬虫时序图.PNG)

###### 百度百科词条爬取项目

> ### URL管理器





###### 简单分布式爬虫


#### 简介

这里实现简单的分布式爬虫，采用主从模式。目前大型的爬虫都采用分布式爬取，所以通过此次实践加深对分布式爬虫的理解。分布式需要考虑如何设计结构，保证各个节点稳定高效地运作。

#### 主从模式

主从模式是指由一台主机作为控制节点，负责管理所有运行网络爬虫的主机，爬虫只需要从控制节点那里接收任务，并把新
生成任务提交给控制节点就可以了，在这个过程中不必与其它爬虫通信。

>1. 采用主从模式，实现简单，利于管理。而控制节点则需要与所有爬虫进行通信。
>2. 主从模式的缺陷在于，控制节点会成为整个系统的瓶颈，容易导致整个分布式网络爬虫系统性能下降。

主从模式的结构如下所示(以一台主机和两台从机为例)：控制节点（ControlNode）主要分为URL管理器，数据存储器和控制调度器。(1)控制调度器通过三个进程来协调URL管理器和数据存储器的工作：(2)一个是URL管理进程，负责URL的管理和将URL传递给爬虫节点；(3)一个是数据提取进程，负责读取爬虫节点返回的数据，将返回数据中的URL交给URL管理进程，将标题和摘要等数据交给数据存储进程；最后一个是数据存储进程，负责将数据提取进程中提交的数据进行本地存储。

对于爬虫节点(SpdierNode):包含爬虫调度器，HTML下载器，HTML解析器，主要负责对URL进行爬取，下载，然后将新的URL,data返回给控制节点(ControlNode)。
爬虫调度器的执行流程：
1. 爬虫调度器从控制节点中的url_q队列读取URL
2. 爬虫调度器调用HTML下载器，HTML解析器获取网页中新的URL和标题摘要
3. 爬虫调度器将新的URL和标题摘要传入result_q队列交给控制节点

![a21](/images/主从.PNG)
![a22](/images/控制节点.PNG)



